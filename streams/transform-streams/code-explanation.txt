-> we are creating the custom transform for our use case over here

-> what we are trying to achieve is we have a json file which is huge_data.json in utils-testing/streams folder
-> if it was not there run the python file with the command python generate_big_file.py 
-> in that json file we have json data in each object we have an property isActive it can be either true or false 
-> we want to send the response where isActive is true, rest we need to filter out


-> here we can't use filter method because it's not and array.
-> even if it's an array we don't read the data completely at once, we read the data based on chunk 
-> so in this case the each chunk can be varied depending on the size let's say the highWaterMark is 10 then each object is broken down in to multiple small pieces.

ex: 

{"id": 1, "us
ername": "user_1
", "email": "u
ser_1@example.
com", "isActi
ve": fal
se, "creat
edAt": "2025-01-0
1T00:00:01Z"}


-> we will get something like this in binary format we need to convert it to string format and transform the entire data back to original json format 


so what does _transform() does in our code?


-> _transform() is a function that Node.js calls every time a new chunk of data arrives.
-> “Here is a piece of data. Do whatever you want with it, then tell me when you’re done.”


syntax

_transform(chunk, encoding, callback) {
   // process chunk
   callback();
}


If you don’t call callback():

-> Stream freezes
-> No more data comes



What problem _transform() is solving in OUR case

-> Data arrives as binary chunks
-> Chunks may cut JSON in half
-> We only want isActive === true


so _transform() must:

-> Convert binary → text
-> Rebuild complete JSON objects
-> Filter them
-> Send valid output downstream



-> chunk.toString() -> converts binary to string format



-> we are converting the binary data to string.
-> assigning it to left over
-> now we are splitting it based on new line
-> this steps convert it into an array 
-> we are removing the last line because the last line can contain incomplete data

-> looping over each line and parsing it and checking if isActive === true
-> if it's true then pushes it to downstream
-> callback() will be called









_flush()


-> it is called once, when the input stream has ended, to process any leftover data.



Why _flush() is REQUIRED

if we remember we are popping out the last line 
this.buffer = lines.pop();

at the end of the file there will be no more chunks 
but this.buffer may still contain a complete json object 

-> without flush the last record will be last 

it works the same way as transform where it will parse and check if any data has isActive
if so it pushes it to callback and once the callback is reached it indicates the complete process is done.
